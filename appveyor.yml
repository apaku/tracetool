version: '{build}'
branches:
    only:
        - release_work
environment:
    matrix:
        - TRACETOOL_ARCH: x86
        - TRACETOOL_ARCH: x64
matrix:
    fast_finish: true

cache:
  - C:\ProgramData\chocolatey\bin -> appveyor.yml
  - C:\ProgramData\chocolatey\lib -> appveyor.yml
  - C:\Program Files\doxygen\ -> appveyor.yml

install:
    - cinst ninja doxygen.install

build_script:
    - call build.cmd %TRACETOOL_ARCH% %APPVEYOR_REPO_TAG%

test_script:
    # Add Qt bin dir to path, using build.cmd envvar, to run tests
    - set PATH=%PATH%;%prefixPath%\bin
    - pushd build
    - ninja test
    - popd
